<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="com.chendi.jiyi.dao.PersonalLetterDAO">
	
	<resultMap type="PersonalLetter" id="PersonalLetterMap">
		<id property="plId" column="pl_id" />
		<result property="plContent" column="pl_content" />
		<result property="plSendTile" column="pl_send_tile" />
		<result property="plHasRead" column="pl_has_read" />
		
		<association property="plSender" column="pl_sender"
			select="com.chendi.jiyi.dao.UserDAO.queryName" />
			
		<association property="plReceiver" column="pl_receiver"
			select="com.chendi.jiyi.dao.UserDAO.queryName" />
	</resultMap>
	 <!-- javaType="User" -->
	<insert id="addLetter" parameterType="PersonalLetter">
		insert into personal_letter(pl_sender,pl_receiver,pl_content,pl_send_time,pl_has_read)
		values(#{plSender.id},#{plReceiver.id},#{plContent},#{plSendTime},#{plHasRead})
	</insert>
	
	<select id="queryByBothId" resultMap="PersonalLetterMap">
		select pl_id,pl_sender,pl_receiver,pl_content,pl_send_time,pl_has_read
		from personal_letter
		<where>
			<if test="senderId!=null and senderId.length()>0">
				pl_sender=#{senderId}
			</if>
			<if test="receiverId!=null and receiverId.length()>0">
				and pl_receiver=#{receiverId}
			</if>
		</where>
	</select>
	
	<select id="queryBySenderId" resultMap="PersonalLetterMap">
		select pl_id,pl_sender,pl_receiver,pl_content,pl_send_time,pl_has_read
		from personal_letter
		where pl_sender=#{senderId}
	</select>
	
	<select id="queryByReceiverId" resultMap="PersonalLetterMap">
		select pl_id,pl_sender,pl_receiver,pl_content,pl_send_time,pl_has_read
		from personal_letter
		where pl_receiver=#{receiverId}
	</select>
	
	<update id="updateRead" parameterType="int">
		update personal_letter
		set pl_has_read=#{plHasRead}
		where pl_id=#{plId}
	</update>
</mapper>