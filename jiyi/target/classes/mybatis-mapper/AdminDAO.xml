<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.chendi.jiyi.dao.AdminDAO">
	<select id="login" resultType="Admin">
		select
		id,name,picture,phone,email
		from admin
		where id=#{id} and
		password=#{password}
	</select>

	<select id="queryById" resultType="Admin">
		select
		id,name,password,picture,phone,email
		from admin
		where id=#{id}
	</select>

	<select id="queryName" resultType="Admin">
		select
		id,name,picture
		from admin
		where id=#{id}
	</select>
	
	<select id="queryRoles" resultType="Role">
		select r.r_id,r.r_name from role r,admin_role ar 
		where ar.admin_id=#{id} and ar.role_id=r.r_id
	</select>
	
	<select id="queryPermissions" resultType="Permission">  
        select p.p_id,p.p_name from role_permission rp ,permission p 
        where rp.role_id in 
        <foreach collection="roleList" item="roleId"
        	open="(" close=")" separator=",">
        	#{roleId}
        </foreach>
         and rp.permission_id=p.p_id  
    </select>  

	<update id="updatePassword">
		update admin
		set password=#{password}
		where id=#{id}
		and password=#{password}
	</update>

	<update id="updatePicById">
		update admin
		set picture=#{picture}
		where id=#{id}
	</update>
</mapper>