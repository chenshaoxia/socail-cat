<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="com.chendi.jiyi.dao.LetterDAO">
	
	<resultMap type="Letter" id="LetterMap">
		<id property="lId" column="l_id" />
		<result property="lContent" column="l_content" />
		<result property="lSendTile" column="l_send_tile" />
		<result property="lHasRead" column="l_has_read" />
		
		<association property="lSender" column="l_sender"
			select="com.chendi.jiyi.dao.AdminDAO.queryName" />
			
		<association property="lReceiver" column="l_receiver"
			select="com.chendi.jiyi.dao.UserDAO.queryName" />
	</resultMap>
	 <!-- javaType="User" -->
	<insert id="addLetter" parameterType="Letter">
		insert into letter(l_sender,l_receiver,l_content,l_send_time,l_has_read)
		values(#{lSender.id},#{lReceiver.id},#{lContent},#{lSendTime},#{lHasRead})
	</insert>
	
	<select id="queryByBothId" resultMap="LetterMap">
		select l_id,l_sender,l_receiver,l_content,l_send_time,l_has_read
		from letter
		<where>
			<if test="senderId!=null and senderId.length()>0">
				l_sender=#{senderId}
			</if>
			<if test="receiverId!=null and receiverId.length()>0">
				and l_receiver=#{receiverId}
			</if>
		</where>
	</select>
	
	<select id="queryBySenderId" resultMap="LetterMap">
		select l_id,l_sender,l_receiver,l_content,l_send_time,l_has_read
		from letter
		where l_sender=#{senderId}
	</select>
	
	<select id="queryByReceiverId" resultMap="LetterMap">
		select l_id,l_sender,l_receiver,l_content,l_send_time,l_has_read
		from letter
		where l_receiver=#{receiverId}
		order by l_send_time DESC
	</select>
	
	<update id="updateRead" parameterType="int">
		update letter
		set l_has_read=#{lHasRead}
		where l_id=#{lId}
	</update>
</mapper>